-- drop objects
drop table d181_dipendente cascade constraints;
drop table d181_cliente cascade constraints;
drop table d181_commessa cascade constraints;
drop table d181_attivita cascade constraints;

-- create tables
create table d181_dipendente (
    id                             number generated by default on null as identity 
                                   constraint d181_dipendente_id_pk primary key,
    dipendente                     varchar2(9 char)
                                   constraint d181_dipendente_dipendente_unq unique not null,
    tariffa                        number not null,
    created                        date not null,
    created_by                     varchar2(255 char) not null,
    updated                        date not null,
    updated_by                     varchar2(255 char) not null
)
;

create table d181_cliente (
    id                             number generated by default on null as identity 
                                   constraint d181_cliente_id_pk primary key,
    cliente                        varchar2(10 char)
                                   constraint d181_cliente_cliente_unq unique not null,
    created                        date not null,
    created_by                     varchar2(255 char) not null,
    updated                        date not null,
    updated_by                     varchar2(255 char) not null
)
;

create table d181_commessa (
    id                             number generated by default on null as identity 
                                   constraint d181_commessa_id_pk primary key,
    commessa                       varchar2(6 char)
                                   constraint d181_commessa_commessa_unq unique,
    created                        date not null,
    created_by                     varchar2(255 char) not null,
    updated                        date not null,
    updated_by                     varchar2(255 char) not null
)
;

create table d181_attivita (
    id                             number generated by default on null as identity 
                                   constraint d181_attivita_id_pk primary key,
    dipendente_id                  number
                                   constraint d181_attivita_dipendente_id_fk
                                   references d181_dipendente not null,
    cliente_id                     number
                                   constraint d181_attivita_cliente_id_fk
                                   references d181_cliente not null,
    commessa_id                    number
                                   constraint d181_attivita_commessa_id_fk
                                   references d181_commessa not null,
    data                           date not null,
    ore                            number not null,
    created                        date not null,
    created_by                     varchar2(255 char) not null,
    updated                        date not null,
    updated_by                     varchar2(255 char) not null
)
;

-- table index
create index d181_attivita_i1 on d181_attivita (cliente_id);
create index d181_attivita_i112 on d181_attivita (commessa_id);
create index d181_attivita_i123 on d181_attivita (dipendente_id);


-- triggers
create or replace trigger d181_dipendente_biu
    before insert or update 
    on d181_dipendente
    for each row
begin
    if inserting then
        :new.created := sysdate;
        :new.created_by := coalesce(sys_context('APEX$SESSION','APP_USER'),user);
    end if;
    :new.updated := sysdate;
    :new.updated_by := coalesce(sys_context('APEX$SESSION','APP_USER'),user);
end d181_dipendente_biu;
/

create or replace trigger d181_cliente_biu
    before insert or update 
    on d181_cliente
    for each row
begin
    if inserting then
        :new.created := sysdate;
        :new.created_by := coalesce(sys_context('APEX$SESSION','APP_USER'),user);
    end if;
    :new.updated := sysdate;
    :new.updated_by := coalesce(sys_context('APEX$SESSION','APP_USER'),user);
end d181_cliente_biu;
/

create or replace trigger d181_commessa_biu
    before insert or update 
    on d181_commessa
    for each row
begin
    if inserting then
        :new.created := sysdate;
        :new.created_by := coalesce(sys_context('APEX$SESSION','APP_USER'),user);
    end if;
    :new.updated := sysdate;
    :new.updated_by := coalesce(sys_context('APEX$SESSION','APP_USER'),user);
end d181_commessa_biu;
/

create or replace trigger d181_attivita_biu
    before insert or update 
    on d181_attivita
    for each row
begin
    if inserting then
        :new.created := sysdate;
        :new.created_by := coalesce(sys_context('APEX$SESSION','APP_USER'),user);
    end if;
    :new.updated := sysdate;
    :new.updated_by := coalesce(sys_context('APEX$SESSION','APP_USER'),user);
end d181_attivita_biu;
/

-- load data
 
insert into d181_dipendente (
    id,
    dipendente,
    tariffa
) values (
    1,
    'FRANCESCA',
    200
);

insert into d181_dipendente (
    id,
    dipendente,
    tariffa
) values (
    2,
    'ANNA',
    150
);

insert into d181_dipendente (
    id,
    dipendente,
    tariffa
) values (
    3,
    'MARCO',
    100
);

commit;
 
-- load data
-- load data
 
insert into d181_cliente (
    id,
    cliente
) values (
    1,
    'CLIENTE_01'
);

insert into d181_cliente (
    id,
    cliente
) values (
    2,
    'CLIENTE_02'
);

insert into d181_cliente (
    id,
    cliente
) values (
    3,
    'CLIENTE_03'
);

commit;
 
-- load data
 
insert into d181_commessa (
    id,
    commessa
) values (
    1,
    'COMM01'
);

insert into d181_commessa (
    id,
    commessa
) values (
    2,
    'COMM02'
);

insert into d181_commessa (
    id,
    commessa
) values (
    3,
    'COMM03'
);

commit;
 
-- load data
 
insert into d181_attivita (
    id,
    dipendente_id,
    cliente_id,
    commessa_id,
    data,
    ore
) values (
    1,
    2,
    3,
    2,
    sysdate - 49,
    65
);

insert into d181_attivita (
    id,
    dipendente_id,
    cliente_id,
    commessa_id,
    data,
    ore
) values (
    2,
    3,
    3,
    3,
    sysdate - 61,
    20
);

insert into d181_attivita (
    id,
    dipendente_id,
    cliente_id,
    commessa_id,
    data,
    ore
) values (
    3,
    2,
    2,
    2,
    sysdate - 57,
    99
);

insert into d181_attivita (
    id,
    dipendente_id,
    cliente_id,
    commessa_id,
    data,
    ore
) values (
    4,
    2,
    2,
    2,
    sysdate - 96,
    63
);

insert into d181_attivita (
    id,
    dipendente_id,
    cliente_id,
    commessa_id,
    data,
    ore
) values (
    5,
    3,
    3,
    1,
    sysdate - 58,
    50
);

insert into d181_attivita (
    id,
    dipendente_id,
    cliente_id,
    commessa_id,
    data,
    ore
) values (
    6,
    1,
    1,
    3,
    sysdate - 48,
    38
);

insert into d181_attivita (
    id,
    dipendente_id,
    cliente_id,
    commessa_id,
    data,
    ore
) values (
    7,
    1,
    1,
    3,
    sysdate - 24,
    8
);

insert into d181_attivita (
    id,
    dipendente_id,
    cliente_id,
    commessa_id,
    data,
    ore
) values (
    8,
    2,
    3,
    3,
    sysdate - 6,
    44
);

insert into d181_attivita (
    id,
    dipendente_id,
    cliente_id,
    commessa_id,
    data,
    ore
) values (
    9,
    2,
    2,
    3,
    sysdate - 34,
    8
);

insert into d181_attivita (
    id,
    dipendente_id,
    cliente_id,
    commessa_id,
    data,
    ore
) values (
    10,
    3,
    3,
    2,
    sysdate - 65,
    72
);

insert into d181_attivita (
    id,
    dipendente_id,
    cliente_id,
    commessa_id,
    data,
    ore
) values (
    11,
    1,
    3,
    1,
    sysdate - 91,
    47
);

insert into d181_attivita (
    id,
    dipendente_id,
    cliente_id,
    commessa_id,
    data,
    ore
) values (
    12,
    2,
    3,
    1,
    sysdate - 31,
    47
);

insert into d181_attivita (
    id,
    dipendente_id,
    cliente_id,
    commessa_id,
    data,
    ore
) values (
    13,
    1,
    1,
    2,
    sysdate - 77,
    96
);

insert into d181_attivita (
    id,
    dipendente_id,
    cliente_id,
    commessa_id,
    data,
    ore
) values (
    14,
    2,
    2,
    3,
    sysdate - 80,
    51
);

insert into d181_attivita (
    id,
    dipendente_id,
    cliente_id,
    commessa_id,
    data,
    ore
) values (
    15,
    3,
    1,
    3,
    sysdate - 11,
    62
);

insert into d181_attivita (
    id,
    dipendente_id,
    cliente_id,
    commessa_id,
    data,
    ore
) values (
    16,
    1,
    2,
    3,
    sysdate - 86,
    18
);

insert into d181_attivita (
    id,
    dipendente_id,
    cliente_id,
    commessa_id,
    data,
    ore
) values (
    17,
    1,
    3,
    1,
    sysdate - 81,
    82
);

insert into d181_attivita (
    id,
    dipendente_id,
    cliente_id,
    commessa_id,
    data,
    ore
) values (
    18,
    1,
    3,
    3,
    sysdate - 38,
    37
);

insert into d181_attivita (
    id,
    dipendente_id,
    cliente_id,
    commessa_id,
    data,
    ore
) values (
    19,
    1,
    1,
    2,
    sysdate - 98,
    74
);

insert into d181_attivita (
    id,
    dipendente_id,
    cliente_id,
    commessa_id,
    data,
    ore
) values (
    20,
    2,
    1,
    2,
    sysdate - 92,
    13
);

insert into d181_attivita (
    id,
    dipendente_id,
    cliente_id,
    commessa_id,
    data,
    ore
) values (
    21,
    1,
    1,
    1,
    sysdate - 24,
    37
);

insert into d181_attivita (
    id,
    dipendente_id,
    cliente_id,
    commessa_id,
    data,
    ore
) values (
    22,
    2,
    1,
    1,
    sysdate - 55,
    14
);

insert into d181_attivita (
    id,
    dipendente_id,
    cliente_id,
    commessa_id,
    data,
    ore
) values (
    23,
    2,
    2,
    2,
    sysdate - 51,
    8
);

insert into d181_attivita (
    id,
    dipendente_id,
    cliente_id,
    commessa_id,
    data,
    ore
) values (
    24,
    1,
    2,
    3,
    sysdate - 35,
    91
);

insert into d181_attivita (
    id,
    dipendente_id,
    cliente_id,
    commessa_id,
    data,
    ore
) values (
    25,
    3,
    1,
    1,
    sysdate - 7,
    39
);

insert into d181_attivita (
    id,
    dipendente_id,
    cliente_id,
    commessa_id,
    data,
    ore
) values (
    26,
    2,
    3,
    3,
    sysdate - 31,
    38
);

insert into d181_attivita (
    id,
    dipendente_id,
    cliente_id,
    commessa_id,
    data,
    ore
) values (
    27,
    3,
    1,
    2,
    sysdate - 46,
    83
);

insert into d181_attivita (
    id,
    dipendente_id,
    cliente_id,
    commessa_id,
    data,
    ore
) values (
    28,
    2,
    2,
    3,
    sysdate - 89,
    51
);

insert into d181_attivita (
    id,
    dipendente_id,
    cliente_id,
    commessa_id,
    data,
    ore
) values (
    29,
    1,
    1,
    1,
    sysdate - 71,
    65
);

insert into d181_attivita (
    id,
    dipendente_id,
    cliente_id,
    commessa_id,
    data,
    ore
) values (
    30,
    3,
    2,
    2,
    sysdate - 89,
    1
);

insert into d181_attivita (
    id,
    dipendente_id,
    cliente_id,
    commessa_id,
    data,
    ore
) values (
    31,
    1,
    2,
    2,
    sysdate - 80,
    38
);

insert into d181_attivita (
    id,
    dipendente_id,
    cliente_id,
    commessa_id,
    data,
    ore
) values (
    32,
    3,
    1,
    1,
    sysdate - 11,
    77
);

insert into d181_attivita (
    id,
    dipendente_id,
    cliente_id,
    commessa_id,
    data,
    ore
) values (
    33,
    1,
    3,
    2,
    sysdate - 90,
    66
);

insert into d181_attivita (
    id,
    dipendente_id,
    cliente_id,
    commessa_id,
    data,
    ore
) values (
    34,
    3,
    3,
    3,
    sysdate - 10,
    55
);

insert into d181_attivita (
    id,
    dipendente_id,
    cliente_id,
    commessa_id,
    data,
    ore
) values (
    35,
    1,
    3,
    2,
    sysdate - 65,
    7
);

insert into d181_attivita (
    id,
    dipendente_id,
    cliente_id,
    commessa_id,
    data,
    ore
) values (
    36,
    1,
    1,
    2,
    sysdate - 46,
    38
);

insert into d181_attivita (
    id,
    dipendente_id,
    cliente_id,
    commessa_id,
    data,
    ore
) values (
    37,
    2,
    1,
    1,
    sysdate - 65,
    67
);

insert into d181_attivita (
    id,
    dipendente_id,
    cliente_id,
    commessa_id,
    data,
    ore
) values (
    38,
    3,
    2,
    1,
    sysdate - 96,
    66
);

insert into d181_attivita (
    id,
    dipendente_id,
    cliente_id,
    commessa_id,
    data,
    ore
) values (
    39,
    3,
    1,
    2,
    sysdate - 47,
    42
);

insert into d181_attivita (
    id,
    dipendente_id,
    cliente_id,
    commessa_id,
    data,
    ore
) values (
    40,
    1,
    3,
    1,
    sysdate - 32,
    81
);

insert into d181_attivita (
    id,
    dipendente_id,
    cliente_id,
    commessa_id,
    data,
    ore
) values (
    41,
    2,
    2,
    2,
    sysdate - 12,
    13
);

insert into d181_attivita (
    id,
    dipendente_id,
    cliente_id,
    commessa_id,
    data,
    ore
) values (
    42,
    3,
    2,
    3,
    sysdate - 7,
    23
);

insert into d181_attivita (
    id,
    dipendente_id,
    cliente_id,
    commessa_id,
    data,
    ore
) values (
    43,
    3,
    3,
    2,
    sysdate - 77,
    61
);

insert into d181_attivita (
    id,
    dipendente_id,
    cliente_id,
    commessa_id,
    data,
    ore
) values (
    44,
    1,
    2,
    2,
    sysdate - 59,
    100
);

insert into d181_attivita (
    id,
    dipendente_id,
    cliente_id,
    commessa_id,
    data,
    ore
) values (
    45,
    3,
    2,
    2,
    sysdate - 54,
    68
);

insert into d181_attivita (
    id,
    dipendente_id,
    cliente_id,
    commessa_id,
    data,
    ore
) values (
    46,
    2,
    3,
    1,
    sysdate - 72,
    89
);

insert into d181_attivita (
    id,
    dipendente_id,
    cliente_id,
    commessa_id,
    data,
    ore
) values (
    47,
    2,
    1,
    1,
    sysdate - 7,
    56
);

insert into d181_attivita (
    id,
    dipendente_id,
    cliente_id,
    commessa_id,
    data,
    ore
) values (
    48,
    2,
    1,
    1,
    sysdate - 45,
    8
);

insert into d181_attivita (
    id,
    dipendente_id,
    cliente_id,
    commessa_id,
    data,
    ore
) values (
    49,
    1,
    3,
    1,
    sysdate - 48,
    12
);

insert into d181_attivita (
    id,
    dipendente_id,
    cliente_id,
    commessa_id,
    data,
    ore
) values (
    50,
    3,
    3,
    2,
    sysdate - 11,
    67
);

commit;
 
 
-- Generated by Quick SQL Venerdì Dicembre 02, 2022  09:37:45
 
/*
dipendente /insert 3
  dipendente vc50 /nn /values francesca,anna,marco /unique
  tariffa num /nn /values 200,150,100

cliente /insert 3
  cliente vc50 /nn /values cliente_01,cliente_02,cliente_03 /unique

commessa /insert 3
  commessa vc30 /values comm01,comm02,comm03 /unique

attivita /insert 50
  dipendente_id /nn
  cliente_id /nn
  commessa_id /nn
  data d /nn
  ore num /nn
#ondelete:restrict
#drop:true
#auditcols:true

# settings = { prefix: "D181", onDelete: "RESTRICT", semantics: "CHAR", auditCols: true, drop: true, language: "EN", APEX: true }
*/
